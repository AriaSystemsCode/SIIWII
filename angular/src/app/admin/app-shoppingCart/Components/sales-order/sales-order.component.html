<div class="orderForm  position-relative">
    <div class="container-fluid orderInfoForm thin-scroll">
        <div
            class="header p-2  d-flex align-items-center  justify-content-end"
        >
            <!-- <h6><span class="headertxt"> Entered By : </span> {{ fullName }}</h6> -->

            <button
                [disabled]="!(isContactsValid && isSalesOrderValidForm())"
                *ngIf="createOrEditorderInfo && !showSaveBtn"
                (click)="createOrEditTransaction()"
                class="continuebtn text-center btn float-right"
            >
                Continue
            </button>
     
       
 
        </div>
        <!-- <hr class="my-2" /> -->
        <div class="row ">
            <h6 class="col-6 mt-4" ><span class="headertxt previewTitle ml3"> Entered By : </span></h6>
            <div class="col-6"    *ngIf="!createOrEditorderInfo &&  !showSaveBtn &&  canChange">
                <button
             
                (click)="showEditMode()"
                class="previewbtn text-center btn float-right"
            >
            
            
            <img src="../../../../../assets/shoppingCart/edit.png"
            class="imgIcon" style="position: relative;right: 0 !important;bottom: 0 !important;"/>
            <span class="mx-1 text-white"> Edit</span>

            </button>
            </div>
            <div *ngIf="createOrEditorderInfo" class="formGroup  col-md-6 col-12">
                <label class="label">Reference #</label>
                <input
                
                    type="text"
                    placeholder="Reference Number"
                    class="form-control "
                    style="width: 95% !important;"
                    [(ngModel)]="reference"
                />
             
           
            </div>
        </div>
        <hr   *ngIf="!createOrEditorderInfo " class="my-2" />

        <div class="pr-3">
            <app-contact
            class="w-100"
            [isCreateOrEdit]="createOrEditorderInfo"
                [activeTab]="activeTab"
                [currentTab]="currentTab"
                [appTransactionsForViewDto]="appTransactionsForViewDto"
                (formValidityChanged)="isContactFormValid($event)"
                (updateAppTransactionsForViewDto)="onUpdateAppTransactionsForViewDto($event)"
                [showDepartment]="activeTab == shoppingCartoccordionTabs.BuyerContactInfo"
            ></app-contact>

            <div class="row">
                <div *ngIf="!createOrEditorderInfo" class="col-md-6 col-12 mt-3">
                 
                        <div
                            class="d-flex align-items-center   w-100"
                        >
                            <h6 class="previewTitle  m-0 p-0 col-6 my-2">Reference Number:</h6>
                            <p class="previewValue  m-0 p-0 col-6 my-2">
                                {{ appTransactionsForViewDto?.reference }}
                            </p>
                        </div>
                  
</div>
                <!-- classification -->
                <app-codes *ngIf="!(classification?.id>0)"
                    [objectType]="entityObjectClassificationType"
                    [editMode]=false
                    (getCodeValue)="getClassCodeValue($event)" ></app-codes>

                    <app-codes *ngIf="classification?.id>0"
                     [objectType]="entityObjectClassificationType"
                     [editMode]=true
                     [code]="classification?.code"
                     (getCodeValue)="getClassCodeValue($event)" ></app-codes>
                <div class="col-md-12 mt-3">
                    <div *ngIf="createOrEditorderInfo" class="d-flex flex-column">
                        <div class="d-flex"> <label class="label pt-1 mr-2 mt-2">Classifications</label> 
                             <div *ngIf="allClassFilteredRecords.length == 0 &&  appTransactionsForViewDto?.entityClassifications?.length == 0" (click)="showClassBtn = true" class="d-flex p-y-1 px-4 rounded  cat"> <span class="mr-2">+</span> Add New Classification</div>
                        <div *ngIf="(allClassFilteredRecords.length != 0 &&  appTransactionsForViewDto?.entityClassifications?.length == 0 && !showExistClass)" (click)="showExistClass = true" class="d-flex p-y-1 px-4 rounded  cat"> <span class="mr-2 mb-2">+</span> Add Classification</div>

<div class="d-flex" *ngIf="showSelectedClass || appTransactionsForViewDto?.entityClassifications?.length != 0
">
    <div
    class="previewValue classificationsValues m-0 p-0 my-2 d-flex justify-content-between position-relative"
    *ngFor="let item of appTransactionsForViewDto?.entityClassifications; index as i"
   
  >
    <span>{{ item?.entityObjectClassificationName }}</span>
    <a class="clear-icon" (click)="deSelectClass(item, i)">
      <i class="fa fa-1x fa-times fa-1x"></i>
    </a>
  </div>



  <div
  class="dimmed  m-0 p-0 my-2 d-flex justify-content-between position-relative"
  *ngFor="let item of tempDeselectedClassification; index as i"
  style="  border-radius: 4px;
  border: 1px solid #D9D9D9;
  background: #D9D9D9 !important;
  padding: 5px 10px !important;
  margin-right: 5px !important;
  font-size: 13px;
  font-weight: 600;"

>
  <span>{{ item?.entityObjectClassificationName }}</span>
  <a class="clear-icon-d" style="background-color: #D9D9D9;">
    <i class="fa fa-1x fa-times fa-1x"></i>
  </a>
</div>
<div *ngIf="(allClassFilteredRecords.length != 0 &&  !showExistClass )" (click)="showExistClass = true" class="d-flex p-y-1 px-4 rounded  cat"> <span class="mr-2">+</span> Add Classification</div>
</div>

                            <!-- </div> -->

         
</div>


<div class="d-flex" *ngIf="(showClassBtn || allClassFilteredRecords.length == 0 ) && !showExistClass">
    <div  class="formGroup  col-8">
      
        <input
        
            type="text"
            placeholder="classification"
            class="form-control "
            style="width: 95% !important;"
            [(ngModel)]="classification.name"
            
        />
     
   
    </div>
    <button
   
 
   (click)="saveClass(classification);hideClassBtn =true;showClassBtn = false"
    class="previewbtn text-center btn "
>
    Save

</button>
<button
(click)="cancelClass();hideClassBtn =true;showExistClass = true;showClassBtn = false;
"
class="cancelbtn text-center btn "
>
Cancel

</button>
 </div>
                   
<!-- </div>       -->
<div class="d-flex" *ngIf=" allClassFilteredRecords.length != 0">
 





<div *ngIf="showExistClass"  class="flex justify-content-center treeSel"    >
    <p-treeSelect 
    class="w-full md:w-20rem"
    containerStyleClass="w-full"
    [(ngModel)]="selectedClassification"
    [options]="allClassFilteredRecords"
    display="chip"
    selectionMode="checkbox"
    placeholder="Select Item"
    [filter]="true"
    filterPlaceholder="Search Items"
    (onNodeSelect)="handleNodeSelect($event)"
    (onNodeUnselect)="handleNodeUnselect($event)"
>
    <ng-template pTemplate="default">
        <div class="header p-2 d-flex align-items-center justify-content-between">
            <div>
                <input type="checkbox" (change)="toggleSelectAll($event)" /> Select All
            </div>
            <button class="btn btn-link" (click)="collapseAll()">Collapse All</button>
        </div>
    </ng-template>
    
    <ng-template let-node pTemplate="default">
        <div (click)="onLabelClick($event)" class="d-flex justify-content-between">
            <span style="margin-top: 8px;">{{ node.label }}</span>
            <div class="treenode-action">
                <div class="btn-group dropdown" dropdown container="body" placement="bottom right">
                    <button title="actions" class="dropdown-toggle btn btn-sm" aria-controls="dropdown-alignment" dropdownToggle>
                        <div class="three-dots"></div>
                    </button>
                    <ul id="dropdown-alignment" class="dropdown-menu dropdown-action-btn dropdown-menu-right" *dropdownMenu>
                        <li><a (click)="addAsNewChildClass(node);showClassBtn = true;showExistClass= false">{{ "AddSubClassification" | localize }}</a></li>
                        <li><a (click)="EditClass(node);showClassBtn = true;showExistClass= false">{{ "Edit" | localize }}</a></li>
                        <li><a (click)="deleteClass(node)">{{ "Delete" | localize }}</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </ng-template>

    <ng-template let-last pTemplate="footer">
        <div class="d-flex justify-content-end p-2">
            <button class="btn bgPurple" (click)="saveClassSelection()">Save</button>
            <button class="btn btn-secondary" (click)="cancelClassSelection()">Cancel</button>
        </div>
    </ng-template>
</p-treeSelect>


</div>

                  
                        <button *ngIf=" showExistClass" (click)="showClassBtn = true;showExistClass= false" class="d-flex p-y-1 px-4 rounded cat"> <span class="mr-2">+</span> Add New Classification</button>
                    </div>
                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="align-items-center big-scroll categoriesClassificationsContainer px-3  d-flex h-100 row   w-100 "
                        >
                            <h6 class="previewTitle  m-0 p-0 pr-2 my-2">
                                Classifications :
                            </h6>
                            <p
                                class="previewValue classificationsValues  m-0 p-0  my-2"
                                *ngFor="
                                    let item of appTransactionsForViewDto?.entityClassifications
                                "
                            >
                                {{ item?.entityObjectClassificationName}}
                            </p>
                            <p
                                class="previewValue m-0 p-0 col-md-6 col-12 my-2"
                                *ngIf="
                             !appTransactionsForViewDto?.entityClassifications  ||  appTransactionsForViewDto?.entityClassifications
                                    ?.length === 0
                            "
                            >
                                -
                            </p>
                        </div>
                    </div>
                </div>
                <!-- classification -->

                <!-- categories -->
                <app-codes *ngIf="!(category?.id>0)"
                    [objectType]="entityObjectType"
                    [editMode]=false
                    (getCodeValue)="getCodeValue($event)" ></app-codes>

                <app-codes *ngIf="category?.id>0"
                     [objectType]="entityObjectType"
                     [editMode]=true
                     [code]="category?.code"
                     (getCodeValue)="getCodeValue($event)" ></app-codes>
                <div class="col-md-12 mt-3">
                    <div *ngIf="createOrEditorderInfo" class="d-flex flex-column">
                        <div class="d-flex"> <label class="label pt-1 mr-2 mt-2">Categories</label>  <div *ngIf="filteredRecords.length == 0  &&  appTransactionsForViewDto?.entityCategories?.length == 0" (click)="showCatBtn = true"  class="d-flex p-y-1 px-4 rounded  cat"> <span class="mr-2">+</span> Add New Categories</div>

                        <div *ngIf="(filteredRecords.length != 0 &&  appTransactionsForViewDto?.entityCategories?.length == 0 && !showExistCat)" (click)="showExistCat = true" class="d-flex p-y-1 px-4 rounded  cat"> <span class="mr-2 mb-2">+</span> Add Categories</div>
                         <div class="d-flex" *ngIf="showSelectedCat || appTransactionsForViewDto?.entityCategories?.length != 0">
                            <div
                              class="previewValue classificationsValues m-0 p-0 my-2 d-flex justify-content-between position-relative"
                              *ngFor="let item of  appTransactionsForViewDto?.entityCategories; index as i"
                              [ngClass]="{ 'dimmed': tempDeselectedCategories.includes(item) }"
                            >
                              <span>{{ item?.entityObjectCategoryName }}</span>
                              <a class="clear-icon" (click)="deSelectCat(item, i)">
                                <i class="fa fa-1x fa-times fa-1x"></i>
                              </a>
                            </div>



                            <div
                            class="dimmed  m-0 p-0 my-2 d-flex justify-content-between position-relative"
                            *ngFor="let item of tempDeselectedCategories; index as i"
                            style="  border-radius: 4px;
                            border: 1px solid #D9D9D9;
                            background: #D9D9D9 !important;
                            padding: 5px 10px !important;
                            margin-right: 5px !important;
                            font-size: 13px;
                            font-weight: 600;"
                         
                          >
                            <span>{{ item?.entityObjectCategoryName }}</span>
                            <a class="clear-icon-d" >
                              <i class="fa fa-1x fa-times fa-1x"></i>
                            </a>
                          </div>

                          <div *ngIf="filteredRecords.length != 0 &&  !showExistCat" (click)="showExistCat = true" class="d-flex p-y-1 px-4 rounded  cat"> <span class="mr-2">+</span> Add Categories</div>
                          </div>


                          
                        </div> 
                          
                        <div class="d-flex" *ngIf="(showCatBtn || filteredRecords.length == 0 ) && !showExistCat">
                            <div  class="formGroup  col-8">
                              
                                <input
                                
                                    type="text"
                                    placeholder="Category"
                                    class="form-control "
                                    style="width: 95% !important;"
                                    [(ngModel)]="category.name"
                                    
                                />
                             
                           
                            </div>
                            <button
                           
                         
                           (click)="saveCat(category);hideCatBtn =true;showCatBtn = false"
                            class="previewbtn text-center btn "
                        >
                            Save
                       
                        </button>
                        <button
                        (click)="cancelCat();hideCatBtn =true;showExistCat = true;showCatBtn = false;"
                        class="cancelbtn text-center btn "
                        >
                        Cancel
                       
                        </button>
                         </div>

                      
<div class="d-flex"  *ngIf=" filteredRecords.length != 0">
 





<div *ngIf="  showExistCat"  class="flex justify-content-center treeSel"   >
    <p-treeSelect 
    class="w-full md:w-20rem"
    containerStyleClass="w-full"
    [(ngModel)]="selectedCategories"
    [options]="filteredRecords"
    display="chip"
    [metaKeySelection]="false"
    selectionMode="checkbox"
    placeholder="Select Item"
    [filter]="true"
    filterPlaceholder="Search Items" 
  
 
    >

    <ng-template pTemplate="default">
        <div class="header p-2 d-flex align-items-center justify-content-between">
            <div>
                <input type="checkbox" (change)="toggleSelectAll($event)" /> Select All
            </div>
            <button class="btn btn-link" (click)="collapseAll()">Collapse All</button>
        </div>
    </ng-template>
        <ng-template let-node pTemplate="default">
            <div (click)="onLabelClick($event)" class="d-flex justify-content-between">
                <span style="margin-top: 8px;" >{{ node.label }}</span>
                <div
                class="treenode-action"
             
              
            >
                <div
                    class="btn-group dropdown"
                    dropdown
                    container="body"
                    placement="bottom right"
                >
                    <button
                        title="actions"
                        class="dropdown-toggle btn btn-sm "
                        aria-controls="dropdown-alignment"
                        dropdownToggle
                    > 
                    <div class="three-dots"></div>

                </button>
                    <ul
                        id="dropdown-alignment"
                        class="dropdown-menu dropdown-action-btn dropdown-menu-right"
                        *dropdownMenu
                    >
                        <li>
                            <a (click)="addAsNewChild(node);showCatBtn= true;showExistCat= false">{{
                                "AddSubcategory" | localize
                            }}</a>
                        </li>
                        <li>
                            <a
                                (click)="EditCat(node);showCatBtn= true;showExistCat= false"
                                >{{ "Edit" | localize }}</a
                            >
                        </li>
                        <li>
                            <a (click)="deleteCat(node)">{{
                                "Delete" | localize
                            }}</a>
                        </li>
                    </ul>
                </div>
            </div>
            </div>
        </ng-template>

        <ng-template let-last pTemplate="footer">
            <div class="d-flex justify-content-end p-2">
                <button class="btn bgPurple" (click)="saveSelection()">Save</button>
                <button class="btn btn-secondary" (click)="cancelSelection()">Cancel</button>
            </div>
        </ng-template>
    </p-treeSelect>
</div>

                  
                        <button *ngIf="showExistCat " (click)="showCatBtn = true;showExistCat = false" class="d-flex p-y-1 px-4 rounded cat"> <span class="mr-2">+</span> Add New Categories</button>
                    </div>
                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="categoriesClassificationsContainer d-flex align-items-center big-scroll px-3    h-100 row   w-100"
                        >
                            <h6 class="previewTitle  m-0 p-0 pr-2 my-2">Categories :</h6>
                            <p
                                class="previewValue classificationsValues  m-0 p-0  my-2"
                                *ngFor="
                                    let item of appTransactionsForViewDto?.entityCategories
                                "
                            >
                                {{ item?.entityObjectCategoryName}}
                            </p>

                    
                            <p
                                class="previewValue   m-0 p-0 col-6 my-2"
                                *ngIf="
                                !appTransactionsForViewDto?.entityCategories  || appTransactionsForViewDto?.entityCategories
                                    ?.length === 0
                            "
                            >
                                -
                            </p>
                        </div>
                    </div>
                </div>
                <!-- categories -->

                <!-- dates -->
                <div class="col-md-6 mt-3 position-relative">
                    <div *ngIf="createOrEditorderInfo">
                        <label class="label">Entered Date</label>
                        <div class="">
                            <p-calendar
                            appendTo="body"
                                [(ngModel)]="enteredDate"
                                [showIcon]="true"
                                (ngModelChange)="onChangeDate()"
                            ></p-calendar>
                           
                        <img src="../../../../../assets/icons/calendar.png"    alt="" srcset="">

                        </div>
                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="d-flex align-items-center   w-100"
                        >
                            <h6 class="previewTitle  m-0 p-0 col-6 my-2">Entered Date :</h6>
                            <p class="previewValue  m-0 p-0 col-6 my-2">
                                {{ appTransactionsForViewDto?.enteredDate?.toString() | date : "MM/dd/yyyy  " }}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mt-3 position-relative">
                    <div *ngIf="createOrEditorderInfo">
                        <label class="label">Start Date</label>
                        <p-calendar
                        appendTo="body"
                            [(ngModel)]="startDate"
                            [showIcon]="true"
                            (ngModelChange)="onChangeDate()"
                        ></p-calendar>
                        <img src="../../../../../assets/icons/calendar.png"   alt="" srcset="">

                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="d-flex align-items-center   w-100"
                        >
                            <h6 class="previewTitle  m-0 p-0 col-6 my-2">Start Date :</h6>
                            <p class="previewValue  m-0 p-0 col-6 my-2">
                                {{ appTransactionsForViewDto?.startDate?.toString() | date : "MM/dd/yyyy "}}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mt-3 position-relative">
                    <div *ngIf="createOrEditorderInfo">
                        <label class="label">Avaialable Date</label>
                        <p-calendar
                        appendTo="body"
                            [(ngModel)]="availableDate"
                            [showIcon]="true"
                            (ngModelChange)="onChangeDate()"
                            [minDate]="completeDate"
                        ></p-calendar>
                        <img src="../../../../../assets/icons/calendar.png"   alt="" srcset="">

                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="d-flex align-items-center   w-100"
                        >
                            <h6 class="previewTitle  m-0 p-0 col-6 my-2">
                                Avaialable Date :
                            </h6>
                            <p class="previewValue  m-0 p-0 col-6 my-2">
                                {{ appTransactionsForViewDto?.availableDate?.toString() | date : "MM/dd/yyyy " }}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mt-3 position-relative">
                    <div *ngIf="createOrEditorderInfo">
                        <label class="label">Complete Date</label>
                        <p-calendar
                        appendTo="body"
                            [(ngModel)]="completeDate"
                            [showIcon]="true"
                            (onSelect)="changeCompleteDate(completeDate)"
                            (ngModelChange)="changeCompleteDate(completeDate)"
                            [minDate]="startDate"
                        ></p-calendar>
                        <img src="../../../../../assets/icons/calendar.png"   alt="" srcset="">

                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="d-flex align-items-center   w-100"
                        >
                            <h6 class="previewTitle  m-0 p-0 col-6 my-2">
                                Complete Date :
                            </h6>
                            <p class="previewValue  m-0 p-0 col-6 my-2">
                                {{ appTransactionsForViewDto?.completeDate?.toString() | date : "MM/dd/yyyy " }}
                            </p>
                        </div>
                    </div>
                </div>
                <!-- dates -->
              
                <!-- currency -->
                <div class="col-md-6 mt-3">
                    <div *ngIf="createOrEditorderInfo">
                        <label class="label">Currency</label>
                        <p-dropdown
                            [options]="currencies"
                            [(ngModel)]="selectedCurrency"
                            optionLabel="code"
                            optionValue="value"
                            class="w-100"
                            (onChange)="onchangeCurrency()"
                        ></p-dropdown>
                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="d-flex align-items-center  "
                        >
                            <h6 class="previewTitle  m-0 p-0 col-md-6 col-12 my-2">Currency :</h6>
                            <p class="previewValue  m-0 p-0 col-md-6 col-12 my-2">
                                {{ appTransactionsForViewDto?.currencyCode }}
                            </p>
                        </div>
                    </div>
                </div>
                <!-- currency -->

                <!-- exchange rate -->
                <div class="col-md-6 mt-3">
                    <div *ngIf="createOrEditorderInfo" class="formGroup">
                        <label class="label">Exchange Rate</label>
                        <input
                        [readonly]="appTransactionsForViewDto?.currencyExchangeRate && appTransactionsForViewDto?.currencyExchangeRate >0"
                            type="text"
                            placeholder="Exchange Rate..."
                            class="form-control w-100"
                            [(ngModel)]="appTransactionsForViewDto.currencyExchangeRate"
                        />
                    </div>
                    <div *ngIf="!createOrEditorderInfo">
                        <div
                            class="d-flex align-items-center   w-100"
                        >
                            <h6 class="previewTitle  m-0 p-0 col-md-6 col-12 my-2">
                                Exchange Rate :
                            </h6>
                            <p class="previewValue  m-0 p-0 col-md-6 col-12 my-2">
                                {{ appTransactionsForViewDto?.currencyExchangeRate }}
                            </p>
                        </div>
                    </div>
                </div>
                <!-- exchange rate -->
            </div>
        </div>
        <hr class="my-2" />
        <div class="d-flex justify-content-end">

    <button
    *ngIf="showSaveBtn"
    [disabled]="!(isContactsValid && isSalesOrderValidForm())"
    (click)="save()"
    class="previewbtn text-center btn float-right"
>
    Save
    <!-- <i class="pi pi-check"></i> -->
</button>
<button
*ngIf="showSaveBtn"
(click)="cancel()"
class="cancelbtn text-center btn float-right"
>
Cancel
<!-- <i class="pi pi-times"></i> -->
</button>
</div>
    </div>
</div>
